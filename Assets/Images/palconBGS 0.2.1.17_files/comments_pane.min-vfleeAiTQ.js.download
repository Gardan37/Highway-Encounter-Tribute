define(["require","exports","tslib","external/react","external/react-redux","modules/clean/react/css","spectrum_comments/comment_stream","modules/clean/react/comments2/actions_adapter","modules/clean/react/comments2/util","modules/clean/react/comments2/transforms","modules/clean/react/comments2/data/selectors","modules/clean/react/comments2/data/actions","modules/clean/react/comments2/data/mentions_api","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models","modules/clean/previews/constants","modules/clean/react/comments2/events","spectrum_comments/comment/time_coded_comment","spectrum_comments/comment_editor/comment_editor","spectrum_comments/comment_editor/time_coded_comment_editor","modules/clean/react/comments2/video_annotations/constants","modules/clean/react/comments2/video_annotations/video_preview_event_emitter","modules/core/i18n","modules/clean/react/previews/video/utils"],function(e,t,o,n,r,i,s,a,m,c,d,p,l,u,v,h,_,w,g,C,O,f,y,E,T,b){"use strict";function A(e){var t=e.playerCurrentTime,r=e.previewType,i=e.showOnboarding,s=e.onCoachmarkClose;if(void 0!==t){var a=void 0;if(b.isHlsAudio()&&r===w.PreviewType.Audio?a=f.AudioCommentEditor:r===w.PreviewType.Video&&(a=f.VideoCommentEditor),a)return n.createElement(a,o.__assign({},e,{currentTime:t,showCoachmark:i,createCoachmark:function(){return n.createElement(u.CoachMark,{title:T._("Target your feedback"),arrowPosition:"top-right",showClose:!0,onCloseButtonClick:s},T._("Adding time codes to comments keeps feedback simple, organized, and all in one place."))}}))}return n.createElement(O.CommentEditor,o.__assign({},e))}Object.defineProperty(t,"__esModule",{value:!0});var M=(function(e){function t(t){var r=e.call(this,t)||this;return r.updateMentionsMatches=function(e){r.setState({mentionsMatches:e})},r.onMentionsQueryUpdated=function(e){r.mentionsApi.query(e,r.updateMentionsMatches)},r.videoPreviewOnboardingDismissed=function(){r.props.dispatch(p.Actions.suppressOnboardingForSession("video_first_paused"))},r.videoPreviewToggled=function(e,t,o){r.props.dispatch(p.Actions.videoPlayerStateChanged({paused:o}))},r.toggleShowResolved=function(){var e=r.props,t=e.dispatch,o=e.showResolved,n=o?"hide_resolved_threads":"show_resolved_threads";t(p.Actions.toggleShowResolved()),t(p.Actions.logEvent(n))},r.createEditor=function(e){var t=r.props,i=t.playerCurrentTime,s=t.showOnboarding,a=t.stream.previewType;return n.createElement(A,o.__assign({},e,{playerCurrentTime:i,previewType:a,showOnboarding:s,onCoachmarkClose:r.onCoachmarkClose}))},r.onCoachmarkClose=function(){r.props.dispatch(p.Actions.suppressOnboardingForSession("initial_video_land")),m.markBrowserHasDismissedOnboardingPopup()},r.mentionsApi=l.mentionsApi(t.viewer),r.state={mentionsMatches:r.mentionsApi.cache},r}return o.__extends(t,e),t.prototype.updateCommentsMoreOptionGroup=function(){var e=this.props.showResolved?h.FileActionButtonType.HIDE_RESOLVED_COMMENTS:h.FileActionButtonType.SHOW_RESOLVED_COMMENTS,t=new _.MoreOptionGroup({fileActionButtonGroup:h.FileActionButtonGroup.COMMENTS,options:[new _.MoreOption({className:"comments-options-item__show-resolved",fileActionButtonType:e,component:function(e){return n.createElement("span",null,e.buttonText)},handler:this.toggleShowResolved})]});void 0===this.moreOptionGroup?v.moreOptionRegistry.addOption(t):v.moreOptionRegistry.replaceOption(this.moreOptionGroup,t),this.moreOptionGroup=t},t.prototype.componentDidMount=function(){this.updateCommentsMoreOptionGroup(),g.Comments2Event.emit("reveal-comments2-in-pane"),E.videoPreviewEventEmitter.addListener(y.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),E.videoPreviewEventEmitter.addListener(y.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled);var e=this.props.dispatch;e(p.Actions.logEvent("show_comments")),e(p.Actions.setSoftHideCommentsPaneOnboarding(m.hasBrowserDismissedOnboardingPopup()&&Math.random()<.8))},t.prototype.componentDidUpdate=function(){this.updateCommentsMoreOptionGroup()},t.prototype.componentWillUnmount=function(){E.videoPreviewEventEmitter.removeListener(y.EventTypes.ONBOARDING_DISMISSED,this.videoPreviewOnboardingDismissed),E.videoPreviewEventEmitter.removeListener(y.EventTypes.VIDEO_TOGGLED,this.videoPreviewToggled)},Object.defineProperty(t.prototype,"actionsAdapter",{get:function(){var e=this.props,t=e.dispatch,o=e.onboardingKeysNotYetMarked,n=e.stream,r=e.viewer;return a.createActionsAdapter(t,n,o,this.onMentionsQueryUpdated,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commentComponent",{get:function(){return b.isHlsAudio()&&this.props.stream.previewType===w.PreviewType.Audio||this.props.stream.previewType===w.PreviewType.Video?C.TimeCodedComment:void 0},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e,t=this.props,o=t.showResolved,r=t.isMobile,i=t.stream,a=t.viewer,m=t.activeThreadId,d=this.props.threads.filter(function(e){return o||!e.resolved});return a&&(e=c.dbxUserToIUser(a)),n.createElement("div",{className:"comments-pane-wrapper"},n.createElement(s.CommentStream,{id:i.id,actionsAdapter:this.actionsAdapter,commentComponent:this.commentComponent,editorComponent:this.createEditor,enabled:!0,isMobile:!!r,mentionsMatches:this.state.mentionsMatches,settings:{canAnnotate:!0,canComment:!0,canRead:!0},userPermissions:{canAnnotate:!0,canComment:!0,canRead:!0},threads:d,user:e,activeThreadID:m}))},t})(n.Component);t.CommentsPaneComponent=M;var P=r.connect(function(e){var t=d.getContext(e),o=t.stream,n=t.viewer;return{activeThreadId:d.getActivatedThreadId(e),playerCurrentTime:d.getPlayerCurrentTime(e),onboardingKeysNotYetMarked:d.getOnboardingKeysNotYetMarked(e),showOnboarding:d.getShowOnboardingOnCommentsPane(e),showResolved:d.getShowResolved(e),stream:o,threads:d.getThreads(e),viewer:n}})(M);t.CommentsPane=i(P,["/static/js/spectrum_comments/index.web-vflTix22J.css","/static/css/comments2-sidebar-vflu2ROdS.css"])});
//# sourceMappingURL=comments_pane.min.js-vflWl4ADB.map