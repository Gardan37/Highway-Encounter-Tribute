define(["require","exports","tslib","esignature_prototype/components/esignature_popover_item","external/react","modules/clean/previews/util","spectrum/popover","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/logging","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/size_class/constants","modules/clean/react/title_bar/overflow_menu","modules/core/browser","modules/core/i18n","modules/clean/react/paper/utils","react-dom","modules/clean/react/paper/open_in_paper_callout_loader","modules/clean/react/paper/open_in_paper_button","modules/clean/react/modal","modules/clean/react/file_viewer/data/actions","esignature_prototype/utils"],function(e,t,n,o,r,i,s,l,a,p,c,u,m,d,h,_,v,f,g,k,C,y,w,I){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var S=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getStateFromRegistry(),t.onRegistryUpdate=function(){t.setState(t.getStateFromRegistry())},t.handleDownloadClick=function(e){return e.preventDefault(),w.download(t.props.file),a.logUserAction(p.UserAction.Download,p.UserActionContext.TitleBarMore)},t.handleRemoveLinkClick=function(e){e.preventDefault(),t.props.onRemoveShareLink&&(t.props.onRemoveShareLink(),a.logUserAction(p.UserAction.RemoveLink,p.UserActionContext.TitleBarMore))},t.handlePreviousVersionClick=function(e){if(e.preventDefault(),!t.props.user)throw new Error("User not specified");return i.redirectToVersionHistory(t.props.file,t.props.user),a.logUserAction(p.UserAction.ViewRevisions,p.UserActionContext.TitleBarMore)},t.handleSignInClick=function(e){e.preventDefault(),a.logUserAction(p.UserAction.SignIn,p.UserActionContext.TitleBarMore),_.redirect(c.getSharedLinkLoginUrl())},t.handleOpenInPaperClick=function(e){e.preventDefault();var n={file:t.props.file,user:t.props.user,sharedLink:t.props.sharedLink,fromModal:!1};f.openFileInPaper(n)},t.handleOpenInPaperSeeHowClick=function(e){e.preventDefault(),y.Modal.showInstance(r.createElement(C.PaperModal,{file:t.props.file,user:t.props.user,sharedLink:t.props.sharedLink}))},t.handleClick=function(){t.setState({hasBeenClicked:!0})},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.removeRegistryListener=u.moreOptionRegistry.addListener(this.onRegistryUpdate)},t.prototype.componentWillUnmount=function(){this.removeRegistryListener()},t.prototype.getStateFromRegistry=function(){return{registeredItems:u.moreOptionRegistry.getOptionItems(),hasBeenClicked:!1}},t.prototype.getPopoverContent=function(){var e=this.props,t=e.allowRemoveLink,n=e.isPrivate,i=e.onRemoveShareLink,a=e.renderSignIn,p=e.shareDownloadOptions,c=e.sizeClass,u=e.showOpenInPaper,_=e.file,f=e.showEmbedToPaperModal,g=[],k=c===d.SizeClass.Small,y=c===d.SizeClass.Medium,w=c===d.SizeClass.Large;if(n&&y&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__share",key:"more-button__share",onSelect:this.props.onClickShareLink},l.getFileActionButtonText(l.FileActionButtonType.SHARE))),null!=i&&t&&!k&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__remove",key:"more-button__remove",onSelect:this.handleRemoveLinkClick},l.getFileActionButtonText(l.FileActionButtonType.REMOVE_LINK))),n&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__download",key:"more-button__download",onSelect:this.handleDownloadClick},l.getFileActionButtonText(l.FileActionButtonType.DOWNLOAD))),p)for(var S=0,P=p;S<P.length;S++){var O=P[S];if(!O.isDisabled){var A="more-button-sl__"+O.userAction;g.push(r.createElement(b,{handler:O.handler,key:A,text:O.text,userAction:O.userAction}))}}if(n&&!k&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__version-history",key:"more-button__version-history",onSelect:this.handlePreviousVersionClick},l.getFileActionButtonText(l.FileActionButtonType.PREVIOUS_VERSIONS))),w&&g.length&&this.state.registeredItems.length&&g.push(r.createElement(s.PopoverContentSeparator,{key:"more_button__seperator"})),w){var E=m.getPopoverOrMobileItemsForMoreOptions(this.state.registeredItems);g=g.concat(E)}return a&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__sign-in",key:"more-button__sign-in",onSelect:this.handleSignInClick},v._("Sign in"))),u&&(w&&g.length&&this.state.registeredItems.length&&g.push(r.createElement(s.PopoverContentSeparator,{key:"more_button__separator2"})),g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__open-in-paper",key:"more-button__open-in-paper",onSelect:this.handleOpenInPaperClick},r.createElement(C.OpenInPaperButtonInMoreDropdown,{file:_,handleOpenInPaperClick:this.handleOpenInPaperClick,sizeClass:c}))),f&&w&&g.push(r.createElement(h.PopoverOrMobileItem,{className:"more-button__open-in-paper-see-how",key:"more-button__open-in-paper-see-how",onSelect:this.handleOpenInPaperSeeHowClick},r.createElement(C.OpenInPaperSeeHowButton,null)))),I.esignaturesEnabled()&&!k&&g.push(r.createElement(o.EsignaturePopoverItem,{file:_})),g},t.prototype.render=function(){var e=this,t=this.props,n=t.file,o=t.sizeClass,i=t.showOpenInPaper,s=t.user,l=this.state.hasBeenClicked;return r.createElement("div",{ref:function(t){return e.ref=g.findDOMNode(t)},onClick:this.handleClick},r.createElement(h.OverflowMenu,{contentWrapperClassName:"react-file-viewer-dropdown"},this.getPopoverContent()),i?r.createElement(k.OpenInPaperCalloutLoader,{file:n,parentHasBeenClicked:l,sizeClass:o,targetNode:this.ref,user:s,variant:f.OpenInPaperButtonVariant.Ellipsis}):null)},t})(r.Component);t.MoreDropdown=S;var b=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props,n=e.handler,o=e.userAction;a.logUserAction(o,p.UserActionContext.TitleBarMore),n()},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.text;return r.createElement(h.PopoverOrMobileItem,{onSelect:this.handleClick},e)},t})(r.PureComponent)});
//# sourceMappingURL=more_dropdown.min.js-vfltEOpHy.map